---
title: 'AWS CLIを使ってSSMパラメータストアのパラメータを取得、作成する'
date: '2022-06-23T00:00:00.000+0900'
excerpt: 'AWS CLIを使ってSSMパラメータストアのパラメータを取得し、別アカウントに作成する方法を解説しました。取得・作成コマンドや注意点も記載しました。'
tags: ['AWS', 'SSM', 'AWS CLI']
published: true
---

## はじめに

AWS アカウント A の Systems Manager パラメータストアに作成したパラメータを別のアカウント B に複製したかったのですが、複数の AWS アカウント間でパラメータを複製または同期する方法が見つかりませんでした。仕方なく AWS CLI を使って「アカウント A からパラメータを取得」「アカウント B にパラメータを作成」を繰り返すことにしました 😓

## 実行環境

- aws-cli@2.4.18

## 取得

```
aws ssm get-parameters-by-path --path "/" --recursive
```

パラメータ階層`/`以下の全てのパラメータを取得します。コマンドを実行すると JSON が返されるので jq とかでよしなに加工します（省略）

:::message
タイプが SecureString のパラメータは暗号化された値が返されます。`--with-decryption`オプションを追加することで復号化された値を取得できます
:::

### 参考

https://dev.classmethod.jp/articles/aws-cli-all-ssm-parameter-get/

https://awscli.amazonaws.com/v2/documentation/api/latest/reference/ssm/get-parameters-by-path.html

## 作成

```
aws ssm put-parameter \
    --name "parameter-name" \
    --description "parameter-description" \
    --value "parameter-value" \
    --type String
```

:::message
自分の環境では value にハイフンを含んでいると以下のエラーが発生しました。エスケープすれば解決するかもしれませんが時間がかかりそうだったので、エラーが発生したパラメータは CLI ではなく AWS コンソールで作成しました 😅

> aws: error: argument --value: expected one argument
> :::

### 参考

https://docs.aws.amazon.com/ja_jp/systems-manager/latest/userguide/param-create-cli.html

https://awscli.amazonaws.com/v2/documentation/api/latest/reference/ssm/put-parameter.html

## 感想

めんどくさかったです。もっといい方法あるで！という方はぜひ教えてください 🙏
